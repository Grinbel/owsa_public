# ============================================================================
# Kubernetes Secrets for waldur-site-agent-openstack
# ============================================================================
# These secrets contain SENSITIVE credentials used by the agent.
# Values are base64 encoded but NOT encrypted by default.
#
# SECURITY WARNING:
# ❌ DO NOT commit real secrets to git!
# ✅ Use one of the secure methods described below
#
# k8s/k3s Compatibility: 100% compatible with both
# ============================================================================

# ============================================================================
# RECOMMENDED: Secure Secret Management Methods
# ============================================================================
#
# METHOD 1: kubectl create secret (Simple, No GitOps)
# -----------------------------------------------------
# Create secrets directly without storing in git:
#
#   kubectl create secret generic waldur-agent-secrets \
#     --from-literal=WALDUR_API_TOKEN='your-waldur-token' \
#     --from-literal=OPENSTACK_PASSWORD='your-openstack-password' \
#     --from-literal=STOMP_PASSWORD='your-stomp-password' \
#     -n waldur-agent
#
#
# METHOD 2: Sealed Secrets (GitOps-friendly)
# -----------------------------------------------------
# Encrypt secrets so they can be committed to git:
#
#   1. Install Sealed Secrets controller
#   2. Create and seal:
#      kubectl create secret generic waldur-agent-secrets \
#        --from-literal=WALDUR_API_TOKEN='...' \
#        --dry-run=client -o yaml | \
#      kubeseal -o yaml > sealed-secret.yaml
#   3. Commit sealed-secret.yaml (it's encrypted!)
#
#
# METHOD 3: External Secrets Operator (Best for production)
# -----------------------------------------------------
# Sync from external secret managers (Vault, AWS Secrets Manager, etc.)
#
#   apiVersion: external-secrets.io/v1beta1
#   kind: ExternalSecret
#   metadata:
#     name: waldur-agent-secrets
#   spec:
#     secretStoreRef:
#       name: vault-backend
#       kind: SecretStore
#     target:
#       name: waldur-agent-secrets
#     data:
#     - secretKey: WALDUR_API_TOKEN
#       remoteRef:
#         key: waldur/credentials
#         property: api_token
#
# ============================================================================

---
# ============================================================================
# Secret: waldur-agent-secrets
# ============================================================================
# Contains all sensitive credentials needed by waldur-site-agent
# ============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: waldur-agent-secrets
  namespace: waldur-agent
  labels:
    app: waldur-site-agent-openstack
    component: credentials
type: Opaque

# ----------------------------------------------------------------------------
# EXAMPLE VALUES (⚠️ REPLACE THESE!)
# ----------------------------------------------------------------------------
# Current base64 encoded values:
#   WALDUR_API_TOKEN: "changeme-waldur-token"
#   OPENSTACK_PASSWORD: "changeme-openstack-pass"
#   STOMP_PASSWORD: "changeme-stomp-pass"
#
# To encode your own values:
#   echo -n 'your-actual-token' | base64
# ----------------------------------------------------------------------------
data:
  WALDUR_API_TOKEN: Y2hhbmdlbWUtd2FsZHVyLXRva2Vu
  OPENSTACK_PASSWORD: Y2hhbmdlbWUtb3BlbnN0YWNrLXBhc3M=
  STOMP_PASSWORD: Y2hhbmdlbWUtc3RvbXAtcGFzcw==

# ----------------------------------------------------------------------------
# ALTERNATIVE: stringData (auto-base64 encoding)
# ----------------------------------------------------------------------------
# Uncomment and use this instead of 'data' for plain text values.
# Kubernetes will automatically base64 encode them.
# WARNING: Still don't commit this to git!
# ----------------------------------------------------------------------------
# stringData:
#   WALDUR_API_TOKEN: "your-waldur-api-token"
#   OPENSTACK_PASSWORD: "your-openstack-admin-password"
#   STOMP_PASSWORD: "your-stomp-password"

# ============================================================================
# How These Secrets Are Used
# ============================================================================
#
# The Deployment mounts these as environment variables:
#
#   env:
#   - name: WALDUR_API_TOKEN
#     valueFrom:
#       secretKeyRef:
#         name: waldur-agent-secrets
#         key: WALDUR_API_TOKEN
#   - name: OPENSTACK_PASSWORD
#     valueFrom:
#       secretKeyRef:
#         name: waldur-agent-secrets
#         key: OPENSTACK_PASSWORD
#   - name: STOMP_PASSWORD
#     valueFrom:
#       secretKeyRef:
#         name: waldur-agent-secrets
#         key: STOMP_PASSWORD
#
# waldur-site-agent substitutes ${ENV_VAR} in config.yaml with env values.
#
# ============================================================================

# ============================================================================
# k8s/k3s Compatibility Notes
# ============================================================================
#
# Secrets work identically in both Kubernetes and k3s.
#
# View secret (values hidden):
#   kubectl get secret waldur-agent-secrets -n waldur-agent
#
# View secret with base64 values:
#   kubectl get secret waldur-agent-secrets -n waldur-agent -o yaml
#
# Decode a specific value:
#   kubectl get secret waldur-agent-secrets -n waldur-agent \
#     -o jsonpath='{.data.WALDUR_API_TOKEN}' | base64 -d
#
# Update secret:
#   kubectl create secret generic waldur-agent-secrets \
#     --from-literal=WALDUR_API_TOKEN='new-token' \
#     --dry-run=client -o yaml | kubectl apply -f -
#
# After updating, restart the agent to pick up new values:
#   kubectl rollout restart deployment waldur-site-agent-openstack -n waldur-agent
#
# ============================================================================
